<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local ="clr-namespace:WeatherAPI_MAUI.ViewModels"
             x:Class="WeatherAPI_MAUI.Views.WeatherPage"
             Title="WeatherPage">

    <ContentPage.BindingContext>
        <local:MainViewModel/>
    </ContentPage.BindingContext>

    <Grid RowDefinitions="Auto, Auto, Auto, *" RowSpacing="20" BackgroundColor="DeepSkyBlue">

        <Grid.GestureRecognizers>
            <SwipeGestureRecognizer Direction="Left" Swiped="Swiped"/>
        </Grid.GestureRecognizers>
        
        <StackLayout Grid.Row="0" Margin="20,20,20,20" Orientation="Horizontal" Spacing="20">
            <Frame Padding="10" CornerRadius="35" HasShadow="True" BorderColor="Black" BackgroundColor="DeepSkyBlue"> 
                <Label Text="Выберете город: " FontSize="Default"/>
            </Frame>
            <Entry Text="{Binding CitySearch, Mode=TwoWay}" x:Name="CitySearch" Placeholder="London" PlaceholderColor="LightGrey" TextColor="Black" HorizontalOptions="StartAndExpand"/>
            <ImageButton Source="search.png" HeightRequest="30" WidthRequest="30" BackgroundColor="DeepSkyBlue"  HorizontalOptions="EndAndExpand" Command="{Binding CityClickCommand}"/>
        </StackLayout>

        <StackLayout Grid.Row="1" Orientation="Vertical">
            <Label Text="{Binding LblCity}" FontSize="35" HorizontalOptions="CenterAndExpand" TextColor="BlanchedAlmond" FontAttributes="Bold"/>
            <Label Text="{Binding LblDicript}" FontSize="Medium" TextColor="BlanchedAlmond" HorizontalOptions="Center"/>
        </StackLayout>

        <Image Grid.Row="2" Source="{Binding ImageIcon}" VerticalOptions="Start" HeightRequest="150" WidthRequest="150" Aspect="AspectFill"/>

        <Grid Grid.Row="3" RowDefinitions="80, Auto, Auto" ColumnDefinitions="0.2*, 0.3*,0.3*, 0.2*" Margin="20" >
            <Image Grid.Row="1" Grid.Column="0" HorizontalOptions="Center" HeightRequest="50" Source="windspeed.png"/>
            <Label Grid.Row="2" Grid.Column="0" HorizontalOptions="Center" Text="{Binding WindSpeed}"/>

            <Label Grid.Row="0" Grid.Column="1"  HorizontalOptions="End" VerticalOptions="Center" FontSize="50" Text="{Binding Temp}" FontAttributes="Bold" />
            <Label Grid.Row="0" Grid.Column="2"  HorizontalOptions="Start" VerticalOptions="Center" FontSize="45" Text="{Binding MinTemp}" FontAttributes="Bold" TextColor="Gainsboro"/>

            <Image Grid.Row="1" Grid.Column="3" HorizontalOptions="Center" HeightRequest="50" Source="vlajnost.png"/>
            <Label Grid.Row="2" Grid.Column="3" HorizontalOptions="Center" Text="{Binding Humidity}"/>
        </Grid>

        <CollectionView Grid.Row="4" VerticalOptions="End" ItemsSource="{Binding CvWeather}" HeightRequest="150">
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Horizontal" ItemSpacing="0"/>
            </CollectionView.ItemsLayout>
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Grid Grid.Row="4" RowDefinitions="Auto, Auto, Auto">

                        <Grid.Background>
                            <LinearGradientBrush>
                                <GradientStop Color="Black" Offset="1"/>
                                <GradientStop Color="DarkSlateGrey" Offset="0"/>
                            </LinearGradientBrush>
                        </Grid.Background>

                        <Image Grid.Row="0" HorizontalOptions="Center" VerticalOptions="Start" HeightRequest="90" Source="{Binding condition.fullicon}"/>
                        <Label  Grid.Row="1" FontSize="Large" HorizontalOptions="Center" Text="{Binding temperature, StringFormat='{}{0:F0}°С'}" TextColor="BlanchedAlmond"/>
                        <Label  Grid.Row="2" FontSize="Small" HorizontalOptions="Center" Text="{Binding hoursOnly, StringFormat='{0:HH:mm}'}" TextColor="BlanchedAlmond"/>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
        
    </Grid>
    
</ContentPage>